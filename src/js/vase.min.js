(function(a){"use strict";function b(b,i){this.element=b,this.settings=a.extend(!0,{},g,i),this._defaults=g,this._name=c,this._nameLower=d,this._objPrefix=e,this._inputAllMask=f,this._methods=h,this.html=a("html"),this.form={obj:null,status:null},this._methods.init(this)}const c="VaSe",d="VaSe".toLowerCase(),e="vase--",f="input, select, textarea",g={api:{url:"",custom:[{name:"api_key",value:""}],param:{success:{name:"result",value:"success"},message:""}},data:{form_method:"post",send_headers:!0},status:{ajax_processing:!1,response_from_api_visible:!0},text_vars:{wrong_input_text:"Wrong input",status_sending:"Sending form...",status_success:"Form sent successfuly",status_error:"Server encountered an error"},form:{novalidate:!0,form:null,status:null},input:{input_container_class:".input",correct_input_class:"vase--correct-input",wrong_input_class:"vase--wrong-input",fields:[],agreements:[],regex_table:{alpha:/^.*$/,phone:/(\(?(\+|00)?48\)?([ -]?))?(\d{3}[ -]?\d{3}[ -]?\d{3})|([ -]?\d{2}[ -]?\d{3}[ -]?\d{2}[ -]?\d{2})/,email:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,name:/^[a-zA-Z\u00E0\u00E1\u00E2\u00E4\u00E3\u00E5\u0105\u010D\u0107\u0119\u00E8\u00E9\u00EA\u00EB\u0117\u012F\u00EC\u00ED\u00EE\u00EF\u0142\u0144\u00F2\u00F3\u00F4\u00F6\u00F5\u00F8\u00F9\u00FA\u00FB\u00FC\u0173\u016B\u00FF\u00FD\u017C\u017A\u00F1\u00E7\u010D\u015B\u0161\u015B\u017E\u00C0\u00C1\u00C2\u00C4\u00C3\u00C5\u0104\u0106\u010C\u0116\u0118\u00C8\u00C9\u00CA\u00CB\u00CC\u00CD\u00CE\u00CF\u012E\u0141\u0143\u00D2\u00D3\u00D4\u00D6\u00D5\u00D8\u00D9\u00DA\u00DB\u00DC\u0172\u016A\u0178\u00DD\u017B\u0179\u00D1\u00DF\u00C7\u0152\u00C6\u010C\u015A\u0160\u015A\u017D\u2202\u00F0 ,.'-]+$/},data_dictionary:{}},callbacks:{onSend:{}}},h={init:function(a){a._methods.initForm(a)},initForm:function(a){a._methods.initForm_generate_defaults(a),a._methods.initForm_generate_content(a),a._methods.formAppendEventListeners(a),a._methods.formApplyMisc(a)},initForm_generate_defaults:function(b){b.form.jq_obj=a(b.element),b.form.status=b.settings.form.status,b.settings.form.novalidate&&b.form.jq_obj.attr("novalidate","novalidate"),b.settings.api.url||(b.settings.api.url=b.form.jq_obj.attr("action")),b.settings.data.form_method||(b.settings.data.form_method=b.form.jq_obj.attr("method"))},initForm_generate_content:function(b){let c=b.form.jq_obj.find("[data-"+b._nameLower+"]"),d=[],e=[],f=a([]);c.each(function(){let c=a(this),g=c.data(b._nameLower);g&&(g.obj=c,"field"===g.element_type?d.push(g):"agreement"===g.element_type?e.push(g):"status"===g.element_type&&(f=f.add(c)))}),b.settings.input.fields.length||(b.settings.input.fields=d),b.settings.input.agreements.length||(b.settings.input.agreements=e),b.form.status||(b.form.status=f),b._methods.initForm_generate_fields(b),b._methods.initForm_generate_agreements(b)},initForm_generate_fields:function(a){let b=a.settings.input.fields.length;for(let c=0;c<b;c++){let b=a.settings.input.fields[c].obj,d=a._methods.initForm_generate_single_field(a,b,a.settings.input.fields[c]);a.settings.input.fields[c]=d}},initForm_generate_single_field:function(b,c,d){let e=a.extend({},{},d),f=c,g=f.data(b._nameLower),h="",i="",j="",k="";g&&(h=f.closest(b.settings.input.input_container_class),i=f.attr("type"),j=g.field_data_type,k=g.wrong_input_text,!k&&(k=b.settings.text_vars.wrong_input_text)),j||(j="tel"===i?"phone":"email"===i?"email":"alpha");let l={obj:f,container:h,label:h.find("label"),type:i,field_data_type:j,max_length:f.attr("max-length"),required:f.prop("required"),wrong_input_text:k};return e&&(l=a.extend({},l,e)),l},initForm_generate_agreements:function(a){let b=a.settings.input.agreements.length;for(let c=0;c<b;c++){let b=a.settings.input.agreements[c].obj,d=a._methods.initForm_generate_single_agreement_field(a,b,a.settings.input.agreements[c]);a.settings.input.agreements[c]=d}},initForm_generate_single_agreement_field:function(b,c,d){let e=a.extend({},{},d),f=c,g=f.data(b._nameLower),h="",i="",j="",k="";g&&(h=f.closest(b.settings.input.input_container_class),i=f.attr("type"),j=g.field_data_type,k=g.wrong_input_text,!k&&(k=b.settings.text_vars.wrong_input_text)),j||(j="checkbox"===i?"checkbox":"radio"===i?"radio":"");let l={obj:f,container:h,label:h.find("label"),type:i,field_data_type:j,required:f.prop("required"),wrong_input_text:k};return e&&(l=a.extend({},l,e)),l},formAppendEventListeners:function(b){for(let c,d=0;d<b.settings.input.fields.length;d++)c=b.settings.input.fields[d],c.obj.data(b._objPrefix+"index",d),c.obj.on("input blur paste",function(){let c=a(this),d=c.data(b._objPrefix+"index"),e=b._methods.ValidateForm(b,[b.settings.input.fields[d]],{append_status:!1,focus_first_wrong:!1,clear_status_if_empty:!0});e&&console.log("input validation successful"),b._methods.formCheckIfInputHasContent(b,c)}),b._methods.formCheckIfInputHasContent(b,c.obj);for(let c,d=0;d<b.settings.input.agreements.length;d++)c=b.settings.input.agreements[d],c.obj.data(b._objPrefix+"index",d),c.obj.on("change",function(){let c=a(this).data(b._objPrefix+"index"),d=b._methods.ValidateForm(b,[b.settings.input.agreements[c]],{append_status:!1,focus_first_wrong:!1,clear_status_if_empty:!0});d&&console.log("agreement validation successful")});b.form.jq_obj.on("submit",function(){b.settings.callbacks.onSend.before&&b.settings.callbacks.onSend.before.function&&a.isFunction(b.settings.callbacks.onSend.before.function)&&b.settings.callbacks.onSend.before.function.apply(b.settings.callbacks.onSend.before.this,[a.extend(!0,{},b.settings.callbacks.onSend.before.parameters)]);let c=b._methods.SendData(b,{callback:{success:{function:b._methods.SendDataReturn,this:b,parameters:[b,{reset_input:!0,message:b.settings.text_vars.status_success,style:"success"}]},error:{function:b._methods.SendDataReturn,this:b,parameters:[b,{reset_input:!1,message:b.settings.text_vars.status_error,style:"error"}]}}});return console.log("Submit form status: "+c.success+", "+c.message),!1})},formCheckIfInputHasContent:function(a,b){b.val()?b.addClass(a._objPrefix+"has-content"):b.removeClass(a._objPrefix+"has-content")},formApplyMisc:function(b){let c=b.form.jq_obj.find(b._inputAllMask);if(console.log("js input mask: "+("undefined"!=typeof a.fn.inputmask)),"undefined"!=typeof a.fn.inputmask){let a=c.filter("input[type=\"tel\"], .jsm--phone");console.log("js input mask || masked items: "),console.log(a),a.inputmask({mask:["###-###-###","## ###-##-##"],greedy:!1,definitions:{"#":{validator:"[0-9]",cardinality:1}}})}},ValidateField:function(b,c,d){let e,f=a.extend({},{},d),g=c,h=g.obj,i=!0,j=null;if("checkbox"===g.type)e=h.prop("checked"),!0!==g.required||e||(i=!1),j=!e;else if("select"===g.type)e=h.val(),!0!==g.required||e||(i=!1),j=!e;else{if(e=h.val(),!0===g.required||e){let a=b.settings.input.regex_table;if(g.field_data_type&&g.field_data_type in a){let b=a[g.field_data_type];b.test(e)||(i=!1)}else i=!1;i=i&&e}j=!e}return{is_valid:i,is_empty:j,field:g}},ValidateForm:function(b,c,d){let e=a.extend({},{append_status:!0,focus_first_wrong:!0,fade_duration:300,clear_status_only:!1,clear_status_if_empty:!1},d),f=c,g=!0,h=[];for(let j=0;j<f.length;j++){let c=f[j],d=b._methods.ValidateField(b,c),i=c.obj,k=c.container,l=k.find("."+b._objPrefix+"status");if(e.append_status?l.remove():l.fadeOut(e.fade_duration,function(){l.remove()}),e.clear_status_only||e.clear_status_if_empty&&!0===d.is_empty)i.removeClass(b.settings.input.correct_input_class),k.removeClass(b.settings.input.correct_input_class),i.removeClass(b.settings.input.wrong_input_class),k.removeClass(b.settings.input.wrong_input_class);else if(d.is_valid)i.removeClass(b.settings.input.wrong_input_class),k.removeClass(b.settings.input.wrong_input_class),i.addClass(b.settings.input.correct_input_class),k.addClass(b.settings.input.correct_input_class);else{if(i.removeClass(b.settings.input.correct_input_class),k.removeClass(b.settings.input.correct_input_class),i.addClass(b.settings.input.wrong_input_class),k.addClass(b.settings.input.wrong_input_class),h.push({field:c,message:""}),e.append_status){let d=a("<span class=\""+b._objPrefix+"status\"></span>");d.text(c.wrong_input_text),d.hide(),c.status=d.appendTo(k),d.fadeIn(e.fade_duration)}g=!1}}return e.focus_first_wrong&&0<h.length&&(h=b._methods.objSortByPositionInDOM(h,"field","obj"),h[0].field.obj.focus()),g},SendDataReturn:function(b,c){let d=a.extend({},{reset_input:!0,message:"",style:""},c);d.reset_input&&b._methods.ResetInput(b,{clear_status_only:!0}),b._methods.StatusClear(b),b._methods.StatusAdd(b,d.message,{style:d.style})},ResetInput:function(b,c){let d=a.extend({},{clear_status_only:!1},c),e=b.form.jq_obj;e[0].reset(),b._methods.ValidateForm(b,b.settings.input.fields,{append_status:!1,focus_first_wrong:!1,clear_status_only:d.clear_status_only}),b._methods.ValidateForm(b,b.settings.input.agreements,{append_status:!1,focus_first_wrong:!1,clear_status_only:d.clear_status_only})},SendData:function(b,c){let d={success:!1,message:"SendData: Error (Default)"},e={url:b.settings.api.url,api_custom:b.settings.api.custom,data:b.form.jq_obj.serialize(),data_dictionary:b.settings.input.data_dictionary,type:b.settings.data.form_method,success_param:b.settings.api.param.success,return_param:b.settings.api.param.message,status_sending_text:b.settings.text_vars.status_sending,send_headers:b.settings.data.send_headers},f=a.extend(!0,{},e,c);b._methods.StatusClear(b);let g=b._methods.ValidateForm(b,b.settings.input.fields),h=b._methods.ValidateForm(b,b.settings.input.agreements,{focus_first_wrong:!1});return g&&h?(console.log("Validation successful"),console.log("Attempting to send data..."),b._methods.StatusClear(b),b._methods.StatusAdd(b,f.status_sending_text,{}),d=b._methods.SendDataAjax(b,f)):d={success:!1,message:"SendData: Error (Validation)"},d},SendDataAjax:function(b,c){let d={success:!1,message:"SendDataAjax: Error (Default)"},e=a.extend(!0,{},{url:"/",type:"POST",api_custom:[],data:"",data_dictionary:{},success_param:{name:"result",value:"success"},return_param:"message",send_headers:!0},c);if(e.api_custom){let a=e.api_custom.length,b="";0<e.data.length&&(b+="&");for(let c=0;c<a;c++)b+=e.api_custom[c].name+"="+e.api_custom[c].value,c<a-1&&(b+="&");e.data+=encodeURI(b)}let f=Object.keys(e.data_dictionary);for(let a,d=0;d<f.length;d++)a=e.data_dictionary[f[d]],console.log(f[d]+" > "+a),e.data=e.data.replace(f[d],a);return console.log(e),b.settings.status.ajax_processing?d={success:!1,message:"SendDataAjax: Error (Processing...)"}:(b.settings.status.ajax_processing=!0,d={success:!0,message:"SendDataAjax: Success (Got into ajax)"},e.send_headers&&a.ajaxSetup({headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"}}),a.ajax({url:e.url,type:e.type,data:e.data,enctype:"multipart/form-data",dataType:"json",processData:!1,success:function(c){let f,g=!1;if(console.log(c),c[e.return_param]){if(a.isArray(c[e.return_param]))for(let a in c[e.return_param])console.log(c[e.return_param][a]);console.log("API status: "+c.status),console.log("API message: "),console.log(c[e.return_param])}f=a.isArray(c[e.return_param])?c[e.return_param].join(", "):c[e.return_param],console.log(f),c[e.success_param.name]?c[e.success_param.name]===e.success_param.value?(d={success:!0,message:"Success (API x:200)"},g=!0):g=!1:g=!1,g?(e.callback.success&&e.callback.success.function&&a.isFunction(e.callback.success.function)&&e.callback.success.function.apply(e.callback.success.instance,e.callback.success.parameters),b.settings.callbacks.onSend.success&&b.settings.callbacks.onSend.success.function&&a.isFunction(b.settings.callbacks.onSend.success.function)&&b.settings.callbacks.onSend.success.function.apply(b.settings.callbacks.onSend.success.this,[a.extend(!0,{},c,b.settings.callbacks.onSend.success.parameters)])):(e.callback.error&&e.callback.error.function&&a.isFunction(e.callback.error.function)&&e.callback.error.function.apply(e.callback.error.this,e.callback.error.parameters),b.settings.callbacks.onSend.error&&b.settings.callbacks.onSend.error.function&&a.isFunction(b.settings.callbacks.onSend.error.function)&&b.settings.callbacks.onSend.error.function.apply(b.settings.callbacks.onSend.error.this,[a.extend(!0,{},c,b.settings.callbacks.onSend.error.parameters)]),b.settings.status.response_from_api_visible&&f&&b._methods.StatusAdd(b,f,{style:"error"})),b.settings.status.ajax_processing=!1},error:function(c){console.log("API status: "+c.status),console.log("API message: "),console.log(c[e.return_param]),d={success:!1,message:"Error (API x:0)"},b.settings.status.ajax_processing=!1,e.callback.error&&e.callback.error.function&&a.isFunction(e.callback.error.function)&&e.callback.error.function.apply(e.callback.error.this,e.callback.error.parameters),b.settings.callbacks.onSend.error&&b.settings.callbacks.onSend.error.function&&a.isFunction(b.settings.callbacks.onSend.error.function)&&b.settings.callbacks.onSend.error.function.apply(b.settings.callbacks.onSend.error.this,[a.extend(!0,{},c,b.settings.callbacks.onSend.error.parameters)])}})),d},StatusAdd:function(b,c,d){let e=a.extend({},{fade_duration:300,style:""},d),f=a("<p></p>");f.text(c),f.appendTo(b.form.status),f.hide(),"success"===e.style?(b._methods.StatusClearStyle(b),b.form.status.addClass("success")):"error"===e.style&&(b._methods.StatusClearStyle(b),b.form.status.addClass("error")),f.fadeIn(e.fade_duration)},StatusClearStyle:function(a){a.form.status.removeClass("success error")},StatusClear:function(a){a._methods.StatusClearStyle(a),a.form.status.empty()},objSortByPositionInDOM:function(a,c,d){let e,f=a;return e=c&&d?f.sort(function(e,a){return e[c][d][0]===a[c][d][0]?0:e[c][d][0].compareDocumentPosition?2&e[c][d][0].compareDocumentPosition(a[c][d][0])?1:-1:e[c][d][0].sourceIndex-a[c][d][0].sourceIndex}):c?f.sort(function(d,a){return d[c][0]===a[c][0]?0:d[c][0].compareDocumentPosition?2&d[c][0].compareDocumentPosition(a[c][0])?1:-1:d[c][0].sourceIndex-a[c][0].sourceIndex}):f.sort(function(c,a){return c[0]===a[0]?0:c[0].compareDocumentPosition?2&c[0].compareDocumentPosition(a[0])?1:-1:c[0].sourceIndex-a[0].sourceIndex}),e}};a.fn.VaSe=function(c){let d=[];return this.each(function(){if(!a.data(this,"plugin_VaSe")){let e=new b(this,c);a.data(this,"plugin_VaSe",e),d.push(e)}if("string"==typeof c){const a=Array.prototype.slice.call(arguments,1);data[c].apply(data,a)}}),1===d.length?d[0]:null}})(jQuery,window,document);